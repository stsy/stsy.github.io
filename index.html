<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Kana Campfire</title>

  <style>
    :root {
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #2b2b45, #08080f);
      color: #f5f5f7;
      min-height: 100dvh;
      overflow-x: hidden;
    }

    .app {
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 12px;
      padding: 12px 14px calc(12px + var(--safe-bottom));
    }

    /* Top bar */
    .top-bar {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      background: rgba(255,255,255,0.06);
      border-radius: 10px;
      padding: 2px;
    }

    .top-bar button {
      background: transparent;
      color: rgba(255,255,255,0.7);
      border: none;
      padding: 10px 6px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: background .2s ease, color .2s ease;
    }

    .top-bar button.active {
      background: rgba(255,255,255,0.14);
      color: #fff;
    }

    /* Arena */
    .arena {
      flex: 1;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      overflow-y: auto;
      padding-top: 6px;
    }

    /* Card */
    .card {
      width: 100%;
      max-width: 420px;
      background: linear-gradient(180deg, #2f3050, #16162d);
      border-radius: 10px;
      padding: 28px 16px 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
    }

    /* Status */
    .combo {
      position: absolute;
      top: 12px;
      right: 14px;
      font-size: 13px;
      opacity: 0;
      transform: scale(.9);
      transition: opacity .25s, transform .25s;
      color: #9dffb3;
      z-index: 5;
    }

    .combo.active { opacity: 1; transform: scale(1.25); }

    .boss {
      position: absolute;
      top: 12px;
      left: 14px;
      font-size: 12px;
      color: #ff7c7c;
      opacity: 0;
      transition: opacity .3s;
      z-index: 5;
    }

    .boss.active { opacity: 1; }

    /* Flame */
    .flame-bg {
      position: absolute;
      top: 42%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 180px;
      opacity: 0.22;
      pointer-events: none;
      z-index: 1;
      animation: flameIdle 2.4s ease-in-out infinite;
    }

    @keyframes flameIdle {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0.18; }
      50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.3; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0.18; }
    }

    @keyframes flamePulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      35% { transform: translate(-50%, -50%) scale(1.4); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .flame-pulse { animation: flamePulse 0.28s ease-out; }

    /* Kana */
    .kana {
      font-size: min(42vw, 120px);
      margin-bottom: 10px;
      position: relative;
      z-index: 4;
      transition: transform .15s ease;
    }

    .kana.pop { transform: scale(1.12); }

    /* Hint */
    .hint {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: min(24vw, 68px);
      opacity: 0;
      pointer-events: none;
      z-index: 3;
    }

    .hint.red { color: rgba(255, 90, 90, 0.65); }
    .hint.green { color: rgba(140, 255, 180, 0.55); }

    @keyframes hintFade {
      0% { opacity: 0; transform: scale(.8) translateY(18px); }
      30% { opacity: .6; transform: scale(1.15) translateY(0); }
      80% { opacity: .5; }
      100% { opacity: 0; transform: scale(1.2) translateY(-14px); }
    }

    /* Input */
    .input-zone {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }

    input {
      width: 4ch;
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      font-size: 22px;
      text-align: center;
      background: #0f1024;
      color: #fff;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.12);
    }

    .streak {
      margin-top: 12px;
      font-size: 13px;
      font-weight: 600;
      opacity: .85;
    }

    footer {
      text-align: center;
      opacity: .45;
      font-size: 11px;
    }

    .keyboard-open footer { display: none; }

    .shake { animation: shake .22s linear; }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      50% { transform: translateX(6px); }
      75% { transform: translateX(-4px); }
      100% { transform: translateX(0); }
    }

    /* Desktop polish */
    @media (min-width: 768px) {
      .app {
        max-width: 520px;
        margin: 0 auto;
      }

      .card {
        padding: 36px 24px 30px;
      }

      .kana {
        font-size: 128px;
      }

      input {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app">

    <div class="top-bar">
      <button id="hiraganaBtn" class="active">Hiragana</button>
      <button id="katakanaBtn">Katakana</button>
    </div>

    <div class="arena">
      <div class="card" id="card">
        <div class="combo" id="combo"></div>
        <div class="boss" id="boss">BOSS</div>
        <div class="flame-bg" id="flameBg">üî•</div>
        <div class="kana" id="kana">„ÅÇ</div>
        <div class="hint" id="hint"></div>

        <div class="input-zone">
          <input id="answer" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" inputmode="latin" maxlength="3" />
        </div>

        <div class="streak">Streak: <span id="streak">0</span> ¬∑ Best: <span id="best">0</span></div>
      </div>
    </div>

    <footer id="footer">¬∑ Kana Campfire ¬∑ Hiragana Practice</footer>
  </div>

  <script>
    const hiraganaCards = [
      { k:'„ÅÇ', r:'a' },{ k:'„ÅÑ', r:'i' },{ k:'„ÅÜ', r:'u' },{ k:'„Åà', r:'e' },{ k:'„Åä', r:'o' },
      { k:'„Åã', r:'ka' },{ k:'„Åç', r:'ki' },{ k:'„Åè', r:'ku' },{ k:'„Åë', r:'ke' },{ k:'„Åì', r:'ko' },
      { k:'„Åï', r:'sa' },{ k:'„Åó', r:'shi' },{ k:'„Åô', r:'su' },{ k:'„Åõ', r:'se' },{ k:'„Åù', r:'so' },
      { k:'„Åü', r:'ta' },{ k:'„Å°', r:'chi' },{ k:'„Å§', r:'tsu' },{ k:'„Å¶', r:'te' },{ k:'„Å®', r:'to' },
      { k:'„Å™', r:'na' },{ k:'„Å´', r:'ni' },{ k:'„Å¨', r:'nu' },{ k:'„Å≠', r:'ne' },{ k:'„ÅÆ', r:'no' },
      { k:'„ÅØ', r:'ha' },{ k:'„Å≤', r:'hi' },{ k:'„Åµ', r:'fu' },{ k:'„Å∏', r:'he' },{ k:'„Åª', r:'ho' },
      { k:'„Åæ', r:'ma' },{ k:'„Åø', r:'mi' },{ k:'„ÇÄ', r:'mu' },{ k:'„ÇÅ', r:'me' },{ k:'„ÇÇ', r:'mo' },
      { k:'„ÇÑ', r:'ya' },{ k:'„ÇÜ', r:'yu' },{ k:'„Çà', r:'yo' },
      { k:'„Çâ', r:'ra' },{ k:'„Çä', r:'ri' },{ k:'„Çã', r:'ru' },{ k:'„Çå', r:'re' },{ k:'„Çç', r:'ro' },
      { k:'„Çè', r:'wa' },{ k:'„Çí', r:'wo' },{ k:'„Çì', r:'n' }
    ];

    const katakanaCards = hiraganaCards.map(c => ({ k: String.fromCharCode(c.k.charCodeAt(0) + 0x60), r: c.r }));

    let deck = hiraganaCards;
    let current = null;
    let streak = 0;
    let best = Number(localStorage.getItem('bestStreak') || 0);

    const kanaEl = document.getElementById('kana');
    const input = document.getElementById('answer');
    const streakEl = document.getElementById('streak');
    const bestEl = document.getElementById('best');
    const flame = document.getElementById('flameBg');
    const hint = document.getElementById('hint');
    const comboEl = document.getElementById('combo');
    const bossEl = document.getElementById('boss');
    const card = document.getElementById('card');

    bestEl.textContent = best;

    function pickCard() {
      current = deck[Math.floor(Math.random() * deck.length)];
      kanaEl.textContent = current.k;
      kanaEl.classList.remove('pop');
      void kanaEl.offsetWidth;
      kanaEl.classList.add('pop');
      input.value = '';
      input.focus();
    }

    function pulse() {
      flame.classList.remove('flame-pulse');
      void flame.offsetWidth;
      flame.classList.add('flame-pulse');
    }

    flame.addEventListener('animationend', e => {
      if (e.animationName === 'flamePulse') flame.classList.remove('flame-pulse');
    });

    function showHint(text, color) {
      hint.textContent = text;
      hint.className = 'hint ' + color;
      hint.style.animation = 'none';
      void hint.offsetHeight;
      hint.style.animation = 'hintFade 1.1s cubic-bezier(.15,.9,.2,1)';
    }

    function updateCombo() {
      if (streak >= 3) {
        comboEl.textContent = 'Combo x' + streak;
        comboEl.classList.add('active');
      } else comboEl.classList.remove('active');

      if (streak >= 20) bossEl.classList.add('active');
      else bossEl.classList.remove('active');
    }

    input.addEventListener('keydown', e => {
      if (e.key !== 'Enter') return;
      const val = input.value.trim().toLowerCase();

      if (val === current.r) {
        streak++;
        pulse();
        showHint(current.r, 'green');
      } else {
        streak = 0;
        showHint(current.r, 'red');
        card.classList.add('shake');
        setTimeout(() => card.classList.remove('shake'), 220);
      }

      if (streak > best) {
        best = streak;
        localStorage.setItem('bestStreak', best);
        bestEl.textContent = best;
      }

      streakEl.textContent = streak;
      updateCombo();
      pickCard();
    });

    document.getElementById('hiraganaBtn').onclick = () => {
      deck = hiraganaCards;
      document.getElementById('footer').textContent = '¬∑ Kana Campfire ¬∑ Hiragana Practice';
      document.getElementById('hiraganaBtn').classList.add('active');
      document.getElementById('katakanaBtn').classList.remove('active');
      streak = 0; streakEl.textContent = 0; updateCombo(); pickCard();
    };

    document.getElementById('katakanaBtn').onclick = () => {
      deck = katakanaCards;
      document.getElementById('footer').textContent = '¬∑ Kana Campfire ¬∑ Katakana Practice';
      document.getElementById('katakanaBtn').classList.add('active');
      document.getElementById('hiraganaBtn').classList.remove('active');
      streak = 0; streakEl.textContent = 0; updateCombo(); pickCard();
    };

    // Keyboard handling
    if (window.visualViewport) {
      visualViewport.addEventListener('resize', () => {
        const keyboardOpen = visualViewport.height < window.innerHeight - 100;
        document.body.classList.toggle('keyboard-open', keyboardOpen);
        const bottom = keyboardOpen
          ? (window.innerHeight - visualViewport.height) + 'px'
          : 'env(safe-area-inset-bottom)';
        document.documentElement.style.setProperty('--safe-bottom', bottom);
      });
    }

    pickCard();
  </script>
</body>
</html>
